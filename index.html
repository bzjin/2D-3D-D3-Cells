<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Body</title>
		<meta charset="utf-8">
		<style type="text/css">
			@font-face {
			  font-family: 'Effra';
			  src: url('fonts/Effra_Std_Rg.ttf');
			}

			@font-face {
			  font-family: 'Effra Heavy';
			  src: url('fonts/Effra_Std_He.ttf');
			}
			body { background-color: #000000; margin: 0px; overflow: hidden; font-family: "Effra";}
			a { color:#0078ff; }
			.slice {
			    border-radius: 100px;
			}
			div {
				padding: 20px;
				margin: 20px;
				float: left;
			}
			text { font-size: 11px; }
			}
			.ticks {
			  font: 10px sans-serif;
			}

			.track,
			.track-inset,
			.track-overlay {
			  stroke-linecap: round;
			}

			.track {
			  stroke: white;
			  stroke-opacity: 0.3;
			  stroke-width: 10px;
			}

			.track-inset {
			  stroke: #ddd;
			  stroke-width: 8px;
			}

			.track-overlay {
			  pointer-events: stroke;
			  stroke-width: 50px;
			  stroke: transparent;
			  cursor: crosshair;
			}

			.handle {
			  fill: #fff;
			  stroke: white;
			  stroke-opacity: 0.5;
			  stroke-width: 1.25px;
			}
		</style>
	</head>
	<body>
		<div id="svg"></div>
		<div id="svgL"></div>
		<div id="canvas"></div>

		<div id="container"></div>
		<!-- D3 Library --> <script src="js/d3.v4.min.js"></script>
    	<!-- D3-Tip --> <script src="js/d3-tip.js"></script>
		<script type="text/javascript" src="js/three.min.js"></script>
		<script type="text/javascript" src="js/Detector.js"></script>
		<script type="text/javascript" src="js/stats.min.js"></script>
    	<script type="text/javascript" src="https://cdn.rawgit.com/mrdoob/three.js/r69/examples/js/loaders/ColladaLoader.js"></script>

		<script type="text/javascript" src="js/RequestAnimationFrame.js"></script>

		<script type="text/javascript">

			init();

			function init() {

			    var canvas = d3.select('#svg').append("canvas")
				.attr("id", "canvas")
				.attr("width", 400)
				.attr("height", 700);
				
			    var context = canvas.node().getContext("2d");

        		/*var svg = d3.select('#svg').append("svg")
        				.attr("width", 400)
     					.attr("height", 700)
     					.style("overflow", "visible");*/

     			var svgL = d3.select('#svgL').append("svg")
        				.attr("width", 300)
     					.attr("height", 700)
     					.style("overflow", "visible");


     			var svgR = d3.select('#svgR').append("svg")
        				.attr("width", 300)
     					.attr("height", 700)
     					.style("overflow", "visible");

				for ( var i = 0; i <= 59; i++ ) {
					var imgurl = "";
					var preurl = "";
					if (i < 10){ 
						imgurl = 'slices/raw_000' + i + '.jpg'; 
						preurl = 'slices/pre_000' + i + '.jpg';}
					else { 
						imgurl = 'slices/raw_00' + i + '.jpg';
						preurl = 'slices/pre_00' + i + '.jpg';}

					svg.append('rect')
						.attr('class', 'slice')
                        .attr('id', 'slice' + i)
                        .attr('x', (i- (Math.floor(i/6)*6)) * 65)
                        .attr('y', Math.floor(i/6) * 75)
                        .attr('width', 60)
                        .attr('height', 60)

					svg.append('image')
                        .attr('class', 'slice')
                        .attr('id', 'preslice' + i)
                        .attr('x', (i- (Math.floor(i/6)*6)) * 65)
                        .attr('y', Math.floor(i/6) * 75)
                        .attr('width', 60)
                        .attr('height', 60)
                        .attr('href', preurl)

					svg.append('image')
                        .attr('class', 'slice')
                        .attr('id', 'slice' + i)
                        .attr('x', (i- (Math.floor(i/6)*6)) * 65)
                        .attr('y', Math.floor(i/6) * 75)
                        .attr('width', 60)
                        .attr('height', 60)
                        .attr('href', imgurl)
                        .on("mouseover", function(){
                        	d3.selectAll("#" + this.getAttribute("id"))
                        		.attr("opacity", .2)
                        })
                        .on("mouseleave", function(){
                        	d3.selectAll("#" + this.getAttribute("id"))
                        		.attr("opacity", 1)
                        });
                    
                    svg.append('text')
                        .attr('class', 'numbers')
                        .attr('x', (i- (Math.floor(i/6)*6)) * 65)
                        .attr('y', Math.floor(i/6) * 75 )
                        .attr("font-size", 10)
                        .attr("fill", "white")
                        .text(i)

                     $(function() {
					    $.ajax({
					        url: "http://mkweb.bcgsc.ca/color-summarizer/?url=IMAGE_URL&precision=low&num_clusters=0&json=1",
					        type: 'GET',
							xhrFields: {
							    withCredentials: true
							  },        
					        crossDomain: true,
					        dataType: 'json',
					        //headers: '[Does something go here?]',
					        success: function(data, status, xhr)
					        {
					        	console.log(data)
					        },
					        error: function(xhr, status, error)
					        {
					            console.log("Error: " + status + " " + error);
					        }
					    });
					}); 
				}

				svgL.append('image')
                        .attr('class', 'slice')
                        .attr('x', 0)
                        .attr('y', 0)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', 'slices/raw_0001.jpg');

				svgL.append('image')
                        .attr('class', 'slice')
                        .attr('x', 0)
                        .attr('y', 240)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', 'slices/raw_0001.jpg');

				svgL.append('image')
                        .attr('class', 'slice')
                        .attr('x', 0)
                        .attr('y', 480)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', 'slices/raw_0001.jpg');

				//Slider
				var x = d3.scaleLinear()
				    .domain([0, 59])
				    .range([10, 190])
				    .clamp(true);

				var xInt = d3.scaleLinear()
				    .domain([0, 59])
				    .range([0, 59])
				    .clamp(true);

				var slider = svgL.append("g")
				    .attr("class", "slider")
				    .attr("transform", "translate(0, 720)")

				slider.append("line")
				    .attr("class", "track")
				    .attr("x1", x.range()[0])
				    .attr("x2", x.range()[1])
				  .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
				    .attr("class", "track-inset")
				  .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
				    .attr("class", "track-overlay")
				    .call(d3.drag()
				        .on("start.interrupt", function() { slider.interrupt(); })
				        .on("start drag", function() { hue(x.invert(d3.event.x)); }));

				slider.insert("g", ".track-overlay")
				    .attr("class", "ticks")
				    .attr("transform", "translate(0," + 18 + ")")
				  .selectAll("text")
				  .data(x.ticks(10))
				  .enter().append("text")
				    .attr("x", x)
				    .attr("text-anchor", "middle")
				    .text(function(d) { return d});

				var handle = slider.insert("circle", ".track-overlay")
				    .attr("class", "handle")
				    .attr("r", 9);

				function hue(h) {
				  svgL.selectAll("text").remove();

				  handle.attr("cx", x(h));
				  var imgurlL = "", imgurlT = "", imgurlB = "";
				  var preurlL = "", preurlT = "", preurlB = "";
				  
				  var base = Math.floor(xInt(h));
				  
				  if (base < 10) { 
				  	imgurlT = 'slices/raw_000' + base + '.jpg';
				  	preurlT = 'slices/pre_000' + base + '.jpg';} 
				  else { 
				  	imgurlT = 'slices/raw_00' + base + '.jpg';
				  	preurlT = 'slices/pre_00' + base + '.jpg';}
				  if (base + 2 < 10) { 	
				  	imgurlL = 'slices/raw_000' + (base+2) + '.jpg';
				  	preurlL = 'slices/pre_000' + (base+2) + '.jpg';}
				  else if (base + 2 > 59) { 
				  	imgurlL = 'slices/raw_00' + base + '.jpg'; 
				  	preurlL = 'slices/pre_00' + base + '.jpg'; }
				  else { 
				  	imgurlL = 'slices/raw_00' + (base+2) + '.jpg';
				    preurlL = 'slices/pre_00' + (base+2) + '.jpg';}
				  if (base + 4 < 10) { 	
				  	imgurlB = 'slices/raw_000' + (base+4) + '.jpg';
				  	preurlB = 'slices/pre_000' + (base+4) + '.jpg';}
				  else if (base + 4 > 59) { 
				  	imgurlL = 'slices/raw_00' + base + '.jpg'; 
				    preurlL = 'slices/pre_00' + base + '.jpg'; }
				  else { 
				  	imgurlB = 'slices/raw_00' + (base+4) + '.jpg';
				  	preurlB = 'slices/pre_00' + (base+4) + '.jpg';}

				  svg.selectAll(".slice")
				  	.style("stroke-width", 0)

				  svg.selectAll(".sliceC").remove();

				  d3.selectAll("#slice"+base)
				  	.style("stroke", "orange")
				  	.style("stroke-width", 5)

				  d3.selectAll("#slice"+(base+2))
				  	.style("stroke", "lightgreen")
				  	.style("stroke-width", 5)

				  d3.selectAll("#slice"+(base+4))
				  	.style("stroke", "steelblue")
				  	.style("stroke-width", 5)
					

				 svgL.append("image")
				  		.attr('class', 'sliceP')
                        .attr('x', 0)
                        .attr('y', 0)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', preurlT)
   
                  svgL.append("image")
				  		.attr('class', 'sliceP')
                        .attr('x', 0)
                        .attr('y', 480)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', preurlB)

				  svgL.append("image")
				  		.attr('class', 'sliceP')
                        .attr('x', 0)
                        .attr('y', 240)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', preurlL)

				  svgL.append("image")
				  		.attr('class', 'sliceC')
                        .attr('x', 0)
                        .attr('y', 0)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', imgurlT)
                        .on("mouseover", function(){
                        	d3.selectAll(".sliceC")
                        		.style("opacity", .2)
                        })
                        .on("mouseleave", function(){
                        	d3.selectAll(".sliceC")
                        		.style("opacity", 1)
                        });

                  svgL.append("image")
				  		.attr('class', 'sliceC')
                        .attr('x', 0)
                        .attr('y', 480)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', imgurlB)
                        .on("mouseover", function(){
                        	d3.selectAll(".sliceC")
                        		.style("opacity", .2)
                        })
                        .on("mouseleave", function(){
                        	d3.selectAll(".sliceC")
                        		.style("opacity", 1)
                        });

				  svgL.append("image")
				  		.attr('class', 'sliceC')
                        .attr('x', 0)
                        .attr('y', 240)
                        .style("opacity", 1)
                        .attr('width', 200)
                        .attr('height', 200)
                        .attr('href', imgurlL)
                        .on("mouseover", function(){
                        	d3.selectAll(".sliceC")
                        		.style("opacity", .2)
                        })
                        .on("mouseleave", function(){
                        	d3.selectAll(".sliceC")
                        		.style("opacity", 1)
                        });

                   var container = document.querySelector("#svgL");
 
					container.addEventListener("click", getClickPosition, false);
					 
					function getClickPosition(e) {
					    var parentPosition = getPosition(e.currentTarget);
					}
					 
					// Helper function to get an element's exact position
					function getPosition(el) {
					  var xPos = 0;
					  var yPos = 0;
					 
					  while (el) {
					    if (el.tagName == "BODY") {
					      // deal with browser quirks with body/window/document and page scroll
					      var xScroll = el.scrollLeft || document.documentElement.scrollLeft;
					      var yScroll = el.scrollTop || document.documentElement.scrollTop;
					 
					      xPos += (el.offsetLeft - xScroll + el.clientLeft);
					      yPos += (el.offsetTop - yScroll + el.clientTop);
					    } else {
					      // for all other non-BODY elements
					      xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
					      yPos += (el.offsetTop - el.scrollTop + el.clientTop);
					    }
					 
					    el = el.offsetParent;
					  }
					console.log(xPos, yPos);
					  return {
					    x: xPos,
					    y: yPos
					  };
					}
                  var xB = 0;
                  svgL.append("text")
                  	.attr("x", xB)
                  	.attr("y", -5)
                  	.style("fill", "orange")
                  	.text("Slice " + base)

                  svgL.append("text")
                  	.attr("x", xB)
                  	.attr("y", 235)
                  	.style("fill", "lightgreen")
                  	.text("Slice " + (base+2))

                  svgL.append("text")
                  	.attr("x", xB)
                  	.attr("y", 475)
                  	.style("fill", "steelblue")
                  	.text("Slice " + (base+4))

				}

			}

			

		</script>
	</body>
</html>
